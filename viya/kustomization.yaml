
#
## start with the basic resources
##
## to personalise for your cluster make these edits globally in this file
##
##   edit viya                to mynamespace
##   edit gofish.unx.sas.com  to mycluster.mycompany.com
#


namespace: viya


resources:

- sas-bases/base
- sas-bases/overlays/network/ingress
- sas-bases/overlays/internal-postgres
- sas-bases/overlays/crunchydata
- sas-bases/overlays/cas-mpp


# please use the lifeboat-ldap for identity
- site-config/identity/gelldap-sssd-configmap.yaml

# open up access to consul UI
# - site-config/hacks/consul-ingress.yaml


transformers:
- sas-bases/overlays/required/transformers.yaml
- sas-bases/overlays/internal-postgres/internal-postgres-transformer.yaml

# you only need these if you dont have a default storage class when you run `k get sc`
# they satisfy PVC from trident storage class
# - site-config/storage/storage-class-cache.yaml
# - site-config/storage/storage-class-consul.yaml
# - site-config/storage/storage-class-crunchy.yaml
# - site-config/storage/storage-class-rabbit.yaml

- site-config/cas/cas-mpp-workers.yaml

- site-config/ingress/body-size.yaml

# open up access to consul UI
# - site-config/hacks/consul-deployment.yaml


patches:

# you only need these if you dont have a default storage class when you run `k get sc`
# they satisfy PVC from trident storage class
# - path: site-config/storage/storage-class.yaml
#   target:
#     kind: PersistentVolumeClaim

# make SQL Server binaries and odbc.ini available to CAS
- path: site-config/access/connectors-cas.yaml
  target:
    kind: CASDeployment

# make SQL Server binaries and odbc.ini available to SAS Studio Sessions
- path: site-config/access/connectors-launcher.yaml
  target:
    kind: PodTemplate
    name: sas-launcher-job-config



configMapGenerator:
- name: ingress-input
  behavior: merge
  literals:
    - INGRESS_HOST=viya.gorcl.hornpolish.net

- name: sas-shared-config
  behavior: merge
  literals:
    - SAS_SERVICES_URL=http://viya.gorcl.hornpolish.net:80

# please use the lifeboat-ldap for identity
# (sorry, you have two put this in two disjoint places)
- name: sas-consul-config
  behavior: merge
  files:
    - SITEDEFAULT_CONF=site-config/identity/gelldap-sitedefault.yaml


secretGenerator:

- name: sas-image-pull-secrets
  behavior: replace
  type: kubernetes.io/dockerconfigjson
  files:
    - .dockerconfigjson=site-config/pull-secrets/cr_sas_com_access.json
