apiVersion: orchestration.sas.com/v1
kind: LifecycleOperation
metadata:
  creationTimestamp: null
  name: sas-deployment-operator.deploy
spec:
  args:
  - name: namespace
  - name: manifest
  - name: permissionsManifest
  steps:
  - args:
    - apply
    - --namespace
    - $namespace
    - -f
    - $permissionsManifest
    cmd: kubectl
    when: $permissionsManifest
  - args:
    - deploy
    - --namespace
    - $namespace
    - --manifest
    - $manifest
    cmd: run
    when: .OperationExists "deploy"
  - args:
    - deploy-default
    - --namespace
    - $namespace
    - --manifest
    - $manifest
    cmd: run
    when: not (.OperationExists "deploy")
  - always: true
    args:
    - delete
    - --namespace
    - $namespace
    - -f
    - $permissionsManifest
    cmd: kubectl
    when: $permissionsManifest
